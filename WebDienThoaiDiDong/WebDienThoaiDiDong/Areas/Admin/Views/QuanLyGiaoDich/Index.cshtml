
@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}
<script src="~/Scripts/jquery-1.10.2.min.js"></script>

<div id="content">
    <!--breadcrumbs-->
    <div id="content-header">
        <div id="breadcrumb"> <a href="index.html" title="Đi đến Trang chủ" class="tip-bottom"><i class="icon-home"></i> Trang chủ</a> <a href="index.html" title="Chi tiết giao dịch" class="tip-bottom">Giao dịch</a></div>
        <h1>Quản lý đơn đặt hàng</h1>
    </div>
    <!--End-breadcrumbs-->
    <!--Action boxes-->
    <div class="container-fluid">
        <!--End-Chart-box-->
        <hr />
        <div class="widget-box">
            <div class="widget-title">
                <span class="icon"> <i class="icon-th"></i> </span>
                <h5>Đơn hàng gần nhất</h5>
            </div>    
            
            <div class="btn-group" style="margin:5px 5px;">
                <button id="btn-ttdh" class="btn btn-info">Trạng thái đơn hàng</button>
                <button data-toggle="dropdown" class="btn btn-info dropdown-toggle"><span class="caret"></span></button>
                <ul id="ttdh" class="dropdown-menu">
                    <li><a href="#">Đã thanh toán</a></li>
                    <li class="divider"></li>
                    <li><a href="#">Chưa thanh toán</a></li>
                    <li class="divider"></li>
                    <li><a href="#">Chờ xử lý</a></li>
                </ul>
            </div>
            <div class="btn-group" style="margin:5px 5px;">
                <button id="btn-tgtdh" class="btn btn-info">Tổng giá trị đơn hàng</button>
                <button data-toggle="dropdown" class="btn btn-info dropdown-toggle"><span class="caret"></span></button>
                <ul id="tgtdh" class="dropdown-menu">
                    <li><a href="#">Dưới 5 triệu</a></li>
                    <li class="divider"></li>
                    <li><a href="#">Từ 5 - 10 triệu</a></li>
                    <li class="divider"></li>
                    <li><a href="#">Trên 10 triệu</a></li>
                </ul>
            </div>
            <button id="macdinh" class="btn btn-primary">Đặt về mặc định</button>
            <div id="dsgd-table">

            </div>
        </div>
    </div>
</div>
<script>
    var checksearch = 0;
    var codesearch = "";
    $(document).ready(function () {
        $.ajax({
            url: '@Url.Action("DanhSachGiaoDichTable", "QuanLyGiaoDich")',
            mtype: "POST",
            datatype: "json",
            data:{
                page: 1
            },
            success: function (data) {
                $("#dsgd-table").html(data);
            }
        });
    });
    function previous(page) {
        if (checksearch == 0) {
            $.ajax({
                url: "@Url.Action("DanhsachgiaodichTable", "QuanLyGiaoDich")",
                type: 'get',
            data: {
                page: page-1
            },
            success: function(response){
                $("#dsgd-table").html(response)
            }

        });
        } else {
            $.ajax({
                url: "@Url.Action("Search", "QuanLyGiaoDich")",
                type: 'get',
                data: {
                    codesearch: codesearch,
                    page: page-1
            },
            success: function(response){
                $("#dsgd-table").html(response)
            }

        })
        }


    }
    function next(page) {
        if (checksearch == 0) {
            $.ajax({
                url: "@Url.Action("DanhsachgiaodichTable", "QuanLyGiaoDich")",
                type: 'get',
            data: {
                page: page+1
            },
            success: function(response){
                $("#dsgd-table").html(response)
            }

        });
        }
        else {
            $.ajax({
                url: "@Url.Action("Search", "QuanLyGiaoDich")",
                type: 'get',
                data: {
                    codesearch: codesearch,
                    page: page+1
            },
            success: function(response){
                $("#dsgd-table").html(response)
            }

        });
        }


    }

    function coutpage(i) {
        if (checksearch == 0) {
            $.ajax({
                url: "@Url.Action("DanhsachgiaodichTable", "QuanLyGiaoDich")",
                type: 'get',
            data: {
                page: i
            },
            success: function (response) {
                $("#dsgd-table").html(response);
            }
        });
        } else {
            $.ajax({
                url: "@Url.Action("Search", "QuanLyGiaoDich")",
                type: 'get',
                data: {
                    codesearch: codesearch,
                    page: i
            },
            success: function (response) {
                $("#dsgd-table").html(response);
            }
        });
        }
       
    }
    function Delete(id, page) {
        var r = confirm("Bạn có chắc chắn muốn xóa");
        if (r == true) {
            $.ajax({
                type: 'post',
                data: {
                    id: id
                },
                url: '@Url.Action("Delete","QuanLyGiaoDich")',
                success: function (response) {
                    if (response == 'True') {
                        $.ajax({
                            url: '@Url.Action("DanhSachGiaoDichTable", "QuanLyGiaoDich")',
                            mtype: "POST",
                            datatype: "json",
                            data: {
                                page: page
                            },
                            success: function (data) {
                                $("#dsgd-table").html(data);
                            }
                        });
                    }
                }
            });
        } else {
            return false;
        }

    }
    //function button tìm kiếm theo trạng thái đơn hàng
    $(function () {

        $("#ttdh li a").click(function () {

            $("#btn-ttdh").text($(this).text());
            checksearch = 1;
            codesearch = $(this).text();
            $.ajax({
                url: '@Url.Action("Search", "QuanLyGiaoDich")',
                mtype: "POST",
                datatype: "json",
                data: {
                    codesearch: codesearch,
                    page:1

                },
                success: function (data) {
                    $("#dsgd-table").html("");
                    $("#dsgd-table").html(data);
                }
            });
        });

    });
    //function button tìm kiếm theo tổng giá trị đơn hàng
    $(function () {

        $("#tgtdh li a").click(function () {
            checksearch = 1;
            $("#btn-tgtdh").text($(this).text());
            codesearch = $(this).text();
            $.ajax({
                url: '@Url.Action("Search", "QuanLyGiaoDich")',
                mtype: "POST",
                datatype: "json",
                data: {
                    codesearch: codesearch,
                    page: 1
                },
                success: function (data) {
                    $("#dsgd-table").html("");
                    $("#dsgd-table").html(data);
                }
            });
        });

    });
    //function button đặt tìm kiếm về mặc định
    $(function () {

        $("#macdinh").click(function () {
            checksearch = 0;
            $("#btn-ttdh").text("Trạng thái đơn hàng");
            $("#btn-ttdh").val("");
            $("#btn-tgtdh").text("Tổng giá trị đơn hàng");
            $("#btn-tgtdh").val("");
            $.ajax({
                url: '@Url.Action("Search", "QuanLyGiaoDich")',
                mtype: "POST",
                datatype: "json",
                data: {
                    codesearch: "",
                    page: 1
                },
                success: function (data) {
                    $("#dsgd-table").html("");
                    $("#dsgd-table").html(data);
                }
            });
        });

    });

</script>
